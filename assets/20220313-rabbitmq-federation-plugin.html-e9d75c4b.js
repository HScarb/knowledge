import{_ as o}from"./plugin-vue_export-helper-c27b6911.js";import{r as l,o as d,c as h,a as e,b as a,d as i,w as n,e as s}from"./app-eaa093f0.js";const c={},u={href:"http://hscarb.github.io/rabbitmq/20220313-rabbitmq-federation-plugin.html",target:"_blank",rel:"noopener noreferrer"},g=e("h1",{id:"rabbitmq-federation-插件使用",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#rabbitmq-federation-插件使用","aria-hidden":"true"},"#"),a(" RabbitMQ Federation 插件使用")],-1),p={class:"table-of-contents"},f=s('<h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述" aria-hidden="true">#</a> 概述</h2><p>RabbitMQ Federation 插件可以将消息从一个 Exchange 复制到另一个 Exchange，或从一个 Queue 分发到另一个 Queue。</p><p>复制的源端被称为 upstream，复制的目的端被称为 downstream。要使用 Federation 插件，需要在两个集群都开启 Federation 插件，并且在 downstream 集群创建 Federation，配置 upstream。</p><h3 id="使用场景" tabindex="-1"><a class="header-anchor" href="#使用场景" aria-hidden="true">#</a> 使用场景</h3><ul><li>将多个集群的消息收集到一个集群</li><li>将一个队列的压力分散到多个集群</li><li>在不下线的情况下将数据从一个集群同步到另一个集群</li><li>减少消息消费的时延</li></ul><h3 id="federation-种类" tabindex="-1"><a class="header-anchor" href="#federation-种类" aria-hidden="true">#</a> Federation 种类</h3><p>可以创建两种类型的 Federation，分别是 Exchange Federation 和 Queue Federation。</p><h4 id="exchange-federation" tabindex="-1"><a class="header-anchor" href="#exchange-federation" aria-hidden="true">#</a> Exchange Federation</h4><p>简单说，它可以实现消息在 Exchange 间的复制（同步）。</p><p>使用 Exchange Federation 可以将消息发到其他集群。效果是，当消息发送到被联邦的 Exchange 时，消息会被发送到本地的 Exchange 和 下游的集群。这样，你就可以在不同的集群多次消费消息。</p><h4 id="queue-federation" tabindex="-1"><a class="header-anchor" href="#queue-federation" aria-hidden="true">#</a> Queue Federation</h4><p>Queue Federation 的效果是消息的负载均衡，它只会将消息发往有空闲消费者的下游集群。也就是说，消息不会被复制。</p><p>常被用于分散压力和集群消息转移。</p><h2 id="使用前提" tabindex="-1"><a class="header-anchor" href="#使用前提" aria-hidden="true">#</a> 使用前提</h2><ul><li>两个 RabbitMQ 服务器或集群</li><li>在两个 RabbitMQ 上开启 Federation 插件</li><li>（可选）为 Federation 的组件单独创建用户</li><li>上下游 RabbitMQ 网络可以通过 AMQP 协议连接</li></ul><h2 id="federation-exchange-使用" tabindex="-1"><a class="header-anchor" href="#federation-exchange-使用" aria-hidden="true">#</a> Federation Exchange 使用</h2><ol><li>满足使用前提</li><li>在下游节点配置 Federation 的 upstream</li><li>在下游节点配置 Policy，指定要被 Federate 的 Exchange 或 Queue</li></ol><h3 id="upstream-上游集群配置" tabindex="-1"><a class="header-anchor" href="#upstream-上游集群配置" aria-hidden="true">#</a> upstream 上游集群配置</h3><ol><li>创建 Exchange</li></ol><figure><img src="https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202203111245154.png" alt="1. 创建 Exchange" tabindex="0" loading="lazy"><figcaption>1. 创建 Exchange</figcaption></figure><ol start="2"><li>创建 Queue</li></ol><figure><img src="https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202203111250015.png" alt="2. 创建 Queue" tabindex="0" loading="lazy"><figcaption>2. 创建 Queue</figcaption></figure><ol start="3"><li>绑定 Exchange 和 Queue</li></ol><figure><img src="https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202203111250347.png" alt="3. 绑定 Exchange 和 Queue" tabindex="0" loading="lazy"><figcaption>3. 绑定 Exchange 和 Queue</figcaption></figure><h3 id="downstream-下游集群配置" tabindex="-1"><a class="header-anchor" href="#downstream-下游集群配置" aria-hidden="true">#</a> downstream 下游集群配置</h3><ol><li>配置 upstream</li></ol><figure><img src="https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202203111251414.png" alt="1. 配置 upstream" tabindex="0" loading="lazy"><figcaption>1. 配置 upstream</figcaption></figure><ol start="2"><li>创建 Federation policy</li></ol><figure><img src="https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202203111251457.png" alt="2. 创建 Federation 的 policy" tabindex="0" loading="lazy"><figcaption>2. 创建 Federation 的 policy</figcaption></figure><ol start="3"><li>检查 Federation 状态</li></ol><figure><img src="https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202203111251640.png" alt="3. 检查 Federation 状态" tabindex="0" loading="lazy"><figcaption>3. 检查 Federation 状态</figcaption></figure><h3 id="测试" tabindex="-1"><a class="header-anchor" href="#测试" aria-hidden="true">#</a> 测试</h3><ul><li>在上游集群向 Exchange 发送消息</li></ul><figure><img src="https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202203111251635.png" alt="在上游集群向 Exchange 发送消息" tabindex="0" loading="lazy"><figcaption>在上游集群向 Exchange 发送消息</figcaption></figure><ul><li>在上下游集群的队列都可以收到消息</li></ul><figure><img src="https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202203111252460.png" alt="在上下游集群的队列都可以收到消息" tabindex="0" loading="lazy"><figcaption>在上下游集群的队列都可以收到消息</figcaption></figure><h2 id="参考资料" tabindex="-1"><a class="header-anchor" href="#参考资料" aria-hidden="true">#</a> 参考资料</h2>',37),m={href:"https://www.rabbitmq.com/federation.html",target:"_blank",rel:"noopener noreferrer"},b={href:"https://www.cloudamqp.com/blog/faq-what-is-the-rabbitmq-federation-plugin.html",target:"_blank",rel:"noopener noreferrer"},x={href:"https://jee-appy.blogspot.com/2018/08/setup-rabbitmq-exchange-federation.html",target:"_blank",rel:"noopener noreferrer"},_=e("hr",null,null,-1),F=e("p",null,"欢迎关注公众号【消息中间件】（middleware-mq），更新消息中间件的源码解析和最新动态！",-1),E=e("figure",null,[e("img",{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202205170102971.jpg",alt:"",tabindex:"0",loading:"lazy"}),e("figcaption")],-1);function y(Q,z){const r=l("ExternalLinkIcon"),t=l("router-link");return d(),h("div",null,[e("p",null,[a("原文地址："),e("a",u,[a("http://hscarb.github.io/rabbitmq/20220313-rabbitmq-federation-plugin.html"),i(r)])]),g,e("nav",p,[e("ul",null,[e("li",null,[i(t,{to:"#概述"},{default:n(()=>[a("概述")]),_:1}),e("ul",null,[e("li",null,[i(t,{to:"#使用场景"},{default:n(()=>[a("使用场景")]),_:1})]),e("li",null,[i(t,{to:"#federation-种类"},{default:n(()=>[a("Federation 种类")]),_:1})])])]),e("li",null,[i(t,{to:"#使用前提"},{default:n(()=>[a("使用前提")]),_:1})]),e("li",null,[i(t,{to:"#federation-exchange-使用"},{default:n(()=>[a("Federation Exchange 使用")]),_:1}),e("ul",null,[e("li",null,[i(t,{to:"#upstream-上游集群配置"},{default:n(()=>[a("upstream 上游集群配置")]),_:1})]),e("li",null,[i(t,{to:"#downstream-下游集群配置"},{default:n(()=>[a("downstream 下游集群配置")]),_:1})]),e("li",null,[i(t,{to:"#测试"},{default:n(()=>[a("测试")]),_:1})])])]),e("li",null,[i(t,{to:"#参考资料"},{default:n(()=>[a("参考资料")]),_:1})])])]),f,e("ul",null,[e("li",null,[e("a",m,[a("Federation Plugin"),i(r)])]),e("li",null,[e("a",b,[a("FAQ: What is the RabbitMQ Federation plugin"),i(r)])]),e("li",null,[e("a",x,[a("Setup RabbitMQ Exchange Federation"),i(r)])])]),_,F,E])}const k=o(c,[["render",y],["__file","20220313-rabbitmq-federation-plugin.html.vue"]]);export{k as default};
